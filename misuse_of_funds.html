<!DOCTYPE html>
<html>

<head>
  <title>Moneyball</title>
  <link rel='stylesheet' type='text/css' href='styles.css'>
  <script src='https://d3js.org/d3.v5.js'></script>
  <script src='./data.js'></script>
  <script src='./generate_charts.js'></script>
</head>

<body>
  <div class='nav'>
    <div class='nav__progress-bar__wrapper'>
      <div class='nav__progress-bar nav__progress-bar--5'></div>
      <div class='nav__progress-bar__bubble nav__progress-bar__bubble--5'></div>
    </div>

    <div class='nav__links'>
      <a href='./index.html' class='nav__links__link nav__links__link--1'>Overview</a>
      <a href='./an_unfair_system.html' class='nav__links__link nav__links__link--2'>An Unfair System</a>
      <a href='./efficiency_kings.html' class='nav__links__link nav__links__link--3'>Efficiency Kings</a>
      <a href='./walk_then_run.html' class='nav__links__link nav__links__link--4'>Walk, then run</a>
      <a href='./misuse_of_funds.html' class='nav__links__link nav__links__link--5 nav__links__link--active'>Misuse of Funds</a>
    </div>
  </div>

  <div class='page-wrapper'>
    <div class='flex'>
      <div class='chart-panel'>
        <div class='chart-panel__title' id='chart-title'>Walk Rate vs. Salary Per Player, 1995-2004</div>
        <div id='walks_vs_salary'></div>
      </div>

      <div class='slide-panel'>
        <div>
          <div id='slide_1'>
            <h3 class='slide_header'>Misuse of Funds</h3>
            <div class='slide_copy'>
              <p>
                Despite the teams who walk more often tend to win more often, a player's walk rate had no detectable
                impact on their salary. Players who were proficient at taking walks tended to fly under the radar or
                were viewed as incapable of hitting despite the positive impact they had on their team's success.
              </p>
            </div>
            <div id='wins_vs_payroll_select'></div>
          </div>
          <div id='slide_2' class='hidden'>
            <h3 class='slide_header'>The Athletics see an opportunity</h3>
            <div class='slide_copy'>
              <p>
                Having lost key players like Johnny Damon and Jason Giambi to much wealthier teams prior to the 2002 season, the Athletics sought out players who were both cheap and took walks at a high rate.
              </p>
            </div>
            <div id='wins_vs_payroll_select'></div>
          </div>
        </div>

        <div class='slide-navigation'>
          <a href='./walk_then_run.html' id='last_button' onclick='back()' class='slide-navigation__button'>Back</a>
          <a href='#' id='next_button' onclick='forward()' class='slide-navigation__button'>&gt;</a>
        </div>
      </div>
    </div>

    <div class='footer'>
      &copy;2020 Casey Benson
      <br>
      Created for the University of Illinois Urbana-Champaign
      <br>
      Stats courtesy <a href='http://www.seanlahman.com/baseball-archive/statistics/'>Sean Lahman's Baseball Database</a> and <a href='https://www.baseball-reference.com/'>Baseball Reference</a>
    </div>

    <script>
      let base_annotations = []
      let scatter_options = {
        id: 'walks_vs_salary',
        x_axis_label: 'Salary (USD)',
        y_axis_label: 'Walk Rate',
        x_domain: [0, 15000000],
        y_domain: [0, 0.35],
        x_key: 'salary',
        y_key: 'walk_rate',
        highlight_key: 'teamID',
        annotations: base_annotations,
        tooltip: 'walks'
      }

      function generateWalkRate(years, relevant_team) {
        let year_range = years || [1995, 2004];
        let radius = years ? 4 : 2;
        let walks_vs_salary_data = batting_with_salaries.data.filter(function (item) {
          return (item.yearID >= year_range[0] && item.yearID <= year_range[1] && item.AB > 100 && item.salary)
        });
        let athletics = []
        walks_vs_salary_data.forEach(function (d) {
          if (d.teamID == 'OAK') {
            athletics.push(d)
          }
        })
        walks_vs_salary_data = walks_vs_salary_data.concat(athletics);
        scatter_options.data = walks_vs_salary_data;
        scatter_options.dot_radius = radius;
        scatter_options.highlight_value = relevant_team;
        let walks_vs_salary = scatter(scatter_options);
      }
      generateWalkRate();


      let current_slide = 1;
      let slide_annotations = {
        1: [],
        2: [{
            title: 'Greg Myers | 18.1% Walk Rate',
            text: "Cost to A's: $800,000",
            x_value: 800000,
            y_value: 0.18056,
            x_adj: 80,
            y_adj: -80
          },
          {
            title: 'David Justice | 17.6% Walk Rate',
            text: "Cost to A's: $3,500,000",
            x_value: 3500000,
            y_value: 0.17588,
            x_adj: 30,
            y_adj: -30
          },
          {
            title: 'Johnny Damon | 10.4% Walk Rate',
            text: "Poached from A's by the Red Sox for $7,250,000",
            x_value: 7250000,
            y_value: 0.10433,
            x_adj: 50,
            y_adj: 50
          }
        ]
      }

      function forward() {
        remove_slide();
        if (current_slide < 2) {
          current_slide++;
        }
        change_slide();
      }

      function back() {
        remove_slide();
        if (current_slide > 1) {
          current_slide--;
        }
        change_slide();
      }

      function remove_slide() {
        document.getElementById('slide_' + current_slide).classList.add('hidden');
      }

      function change_slide() {
        document.getElementById('slide_' + current_slide).classList.remove('hidden');
        scatter_options.annotations = base_annotations.concat(slide_annotations[current_slide]);
        if (current_slide == 1) {
          generateWalkRate();
          document.getElementById('chart-title').innerHTML = 'Walk Rate vs. Salary Per Player, 1995-2004';
        } else {
          document.getElementById('chart-title').innerHTML = 'Walk Rate vs. Salary Per Player, 2002';
          generateWalkRate([2002, 2002], 'OAK');
        }
        updateButtons();
      }

      function updateButtons() {
        let next_el = document.getElementById('next_button')
        let last_el = document.getElementById('last_button')
        if (current_slide == 1) {
          last_el.innerHTML = 'Back'
          setTimeout(function () {
            last_el.href = './walk_then_run.html'
          }, 1)
        } else {
          last_el.innerHTML = '<'
          last_el.href = '#'
        }

        if (current_slide == 2) {
          next_el.classList.add('slide-navigation__button--inactive')
        } else {
          next_el.classList.remove('slide-navigation__button--inactive')
        }
      }
    </script>
</body>

</html>
